<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GSI Map Viewer</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div id="container">
        <div id="panel">
            <h2>都市計画シュミレーター</h2>

            <div class="tab-nav">
                <button class="tab-btn active" data-tab="home">ホーム</button>
                <button class="tab-btn" data-tab="calc">計算</button>
                <button class="tab-btn" data-tab="report">レポート</button>
            </div>

            <div id="home-tab" class="tab-content active">
                <div class="control-group">
                    <label for="address-input">場所検索</label>
                    <input type="text" id="address-input" placeholder="地名を入れてください">
                    <ul id="suggestion-list"></ul>
                </div>
                <div class="control-group">
                    <h3>傾向表示</h3>
                    <label><input type="checkbox" checked>スタンダード </label>
                    <label><input type="checkbox" id="grid-toggle"> セル表示</label>
                    <label for="viz-mode" style="margin-top: 10px;">表示項目選択</label>
                    <select id="viz-mode" style="width: 100%; padding: 5px; margin-bottom: 10px;">
                        <option value="none">通常</option>
                        <option value="pop_total">合計人口数</option>
                        <option value="ratio_65_over">高齢者割合(65歳以上)</option>
                        <option value="ratio_15_64">生産人口割合(15-65歳)</option>
                        <option value="traffic_flow">推計交通量(シュミレーション)</option>
                        <option value="land_price_sim">推計地価(シュミレーション)</option>
                        <option value="pop_sim">流動人口数(シュミレーション)</option>
                        <option value="vacant_floor_area_rate">空き床面積率</option>
                    </select>
                    <button id="range-select-btn" style="margin-top: 10px;">範囲選択</button>
                </div>
            </div>

            <div id="calc-tab" class="tab-content">
                <h3>計算</h3>
                
                <div class="control-group">
                    <h4>交通量シュミレーション</h4>
                    <button id="run-simulation-btn"
                        style="width: 100%; padding: 10px; margin-bottom: 10px; cursor: pointer;">
                        計算実行
                    </button>
                    <div id="simulation-status" style="margin-bottom: 10px; color: #666;">Status: Ready</div>

                    <label for="flow-max-slider">交通量上限設定 (色付け基準): <span
                            id="flow-max-val">1000</span></label>
                    <input type="range" id="flow-max-slider" min="100" max="10000" step="100" value="1000"
                        style="width: 100%;">
                </div>

                <hr style="margin: 20px 0; border: 0; border-top: 1px solid #ccc;">

                <div class="control-group">
                    <h4>地価推計</h4>
                    <button id="init-city-btn" style="width: 100%; padding: 8px; margin-bottom: 5px; cursor: pointer; background-color: #e0e0e0;">
                        計算実行
                    </button>
                    <div id="city-status" style="margin-bottom: 10px; font-size: 0.9em; color: #666;">Status: Not Initialized</div>
                    <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 8px;">
                        <label for="step-years" style="flex: 1;">進める年数</label>
                        <select id="step-years" style="flex: 1; padding: 6px;">
                            <option value="1">1年後</option>
                            <option value="2">2年後</option>
                            <option value="3">3年後</option>
                        </select>
                    </div>
                    <div id="city-year-label" style="margin-bottom: 8px; font-size: 0.9em; color: #444;">シミュレーション年: 0年後</div>
                    
                    <div style="display: flex; gap: 5px;">
                        <button id="step-city-btn" style="flex: 1; padding: 10px; cursor: pointer; background-color: #4CAF50; color: white; border: none;">
                            次の計算
                        </button>
                        <button id="reset-city-btn" style="flex: 1; padding: 10px; cursor: pointer; background-color: #f44336; color: white; border: none;">
                            リセット
                        </button>
                    </div>
                </div>
            </div>

            <div id="report-tab" class="tab-content">
                <h3>レポート</h3>
                <p>Report tools will be here.</p>
            </div>
        </div>
        <div id="map">
            <div id="legend" class="leaflet-bottom leaflet-right"></div>
        </div>
        <div id="property-panel" style="display: none;">
            <div class="panel-header">
                <h3>セル内情報</h3>
                <button id="close-property-panel">×</button>
            </div>
            <div id="property-content"></div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="{{ url_for('static', filename='js/state.js') }}"></script>
    <script src="{{ url_for('static', filename='js/map.js') }}"></script>
    <script src="{{ url_for('static', filename='js/address.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tabs.js') }}"></script>
    <script src="{{ url_for('static', filename='js/style.js') }}"></script>
    <script src="{{ url_for('static', filename='js/selection.js') }}"></script>
    <script src="{{ url_for('static', filename='js/simulation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/grid.js') }}"></script>
    <script src="{{ url_for('static', filename='js/report.js') }}"></script>
</body>

</html>
